import{r as t,h as i,H as e,d as s}from"./p-cd2828d1.js";import{r as o,l as r,c as a,f as n}from"./p-bb39c509.js";import{B as l}from"./p-4c11f27f.js";import{F as c}from"./p-6249f205.js";import{t as h}from"./p-df5b8a0d.js";const d=class{constructor(i){t(this,i)}render(){return i(e,null,i("ta-app-page",null,i("div",{class:"header"},i("div",{class:"title"},"Details"),i("ta-icon",{icon:"settings"}))))}};d.style=":host{display:block;border-left:solid 3px #e5e5e5}.header{display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between;-ms-flex-align:start;align-items:flex-start;border-bottom:solid 2px #c3cbd3;padding-bottom:12px}.title{font-size:14px;font-weight:500;font-stretch:normal;font-style:normal;line-height:normal;letter-spacing:-0.05px;color:#425a70}.metrics{margin-top:43px}.metric-item{margin-top:12px}.metric-item:first-child{margin-top:0}.label{font-size:12px;font-weight:900;font-stretch:normal;font-style:normal;line-height:1.33;letter-spacing:normal;color:#425a70}.value{margin-top:4px;font-size:12px;font-weight:100;font-stretch:normal;font-style:normal;line-height:1.33;letter-spacing:normal;color:#6886a2}";const p={concurrentUploads:3};class x{constructor(){this.config=p,this.file=null,this.activeConnections=[],this.chunksQueue=[],this.applicationId="",this.uploadId="",this.chunksQuantity=0,this.progressCache=[],this.uploadedSize=0}setConfig(t){console.log(t)}setup(t,i){if(!i)throw new Error("file is empty");this.file=i,this.applicationId=t,this.uploadId=this.createUploadId(),this.chunksQuantity=Math.ceil(this.file.size/5e6),this.chunksQueue=new Array(this.chunksQuantity).fill(1).map((t,i)=>i)}start(t,i){this.setup(t,i),this.sendNextChunk()}sendNextChunk(){const t=Object.keys(this.activeConnections).length;if(t>=this.config.concurrentUploads)return;if(!this.chunksQueue.length)return void(t||this.sendCompleted().then(t=>{this.onSuccess(t)}).catch(t=>{this.onError(t)}));const i=this.chunksQueue.pop(),e=5e6*i,s=this.file.slice(e,e+5e6);this.sendChunk(s,i).then(()=>{this.sendNextChunk()}).catch(()=>{this.chunksQueue.push(i),setTimeout(()=>{this.sendNextChunk()},4200)}),this.sendNextChunk()}sendCompleted(){return new Promise((t,i)=>{const e={applicationId:this.applicationId,fileName:this.file.name,uploadId:this.uploadId},s=`${l()}/chunks-completed`;fetch(s,{method:"POST",headers:{Authorization:`Bearer ${window.localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify(e)}).then(t=>t.json()).then(e=>{if(e.error)return i(e);t(e)}).catch(t=>{i(t)})})}sendChunk(t,i){return new Promise(async(e,s)=>{try{await this.upload(t,i),e()}catch(o){return void s(o)}})}regularUpload(t,i){const e=`${l()}/upload`,s=new XMLHttpRequest;s.responseType="json",s.open("POST",e,!0),s.setRequestHeader("Authorization",`Bearer ${window.localStorage.getItem("token")}`),s.upload.onprogress=t=>{this.onProgress(t.loaded,t.total)},s.onerror=()=>{this.onError()},s.onload=()=>{201!==s.status?this.onError():this.onSuccess(s.response)};const o=new FormData;o.append("application_id",t),o.append("file_name",i.name),o.append("file",i),s.send(o)}upload(t,i){return new Promise((e,s)=>{const o=this.activeConnections[i]=new XMLHttpRequest;o.upload.addEventListener("progress",t=>this.handleProgress(t,i)),o.addEventListener("error",t=>this.handleProgress(t,i)),o.addEventListener("abort",t=>this.handleProgress(t,i)),o.addEventListener("loadend",t=>this.handleProgress(t,i));const r=`${l()}/chunk-upload`;o.open("post",r,!0),o.setRequestHeader("Authorization",`Bearer ${window.localStorage.getItem("token")}`),o.onreadystatechange=()=>{4===o.readyState&&200===o.status&&(e(),delete this.activeConnections[i])},o.onerror=t=>{s(t),delete this.activeConnections[i]},o.onabort=()=>{s(new Error("Upload canceled by user")),delete this.activeConnections[i]};const a=new FormData;a.append("upload_id",this.uploadId),a.append("chunk_number",i.toString()),a.append("total_chunks",this.chunksQuantity.toString()),a.append("total_file_size",this.file.size.toString()),a.append("file_name",this.file.name),a.append("application_id",this.applicationId),a.append("data",t),o.send(a)})}handleProgress(t,i){"progress"!==t.type&&"error"!==t.type&&"abort"!==t.type||(this.progressCache[i]=t.loaded),"loadend"===t.type&&(this.uploadedSize+=this.progressCache[i]||0,delete this.progressCache[i]);const e=Object.keys(this.progressCache).reduce((t,i)=>t+this.progressCache[i],0),s=Math.min(this.uploadedSize+e,this.file.size);this.onProgress(s,this.file.size)}createUploadId(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const i=16*Math.random()|0;return("x"==t?i:3&i|8).toString(16)}))}on(t,i){this[t]=i}}const f=class{constructor(i){t(this,i),this.dragging=!1,this.previewFiles=[],this.handleDragEnter=t=>{this.stopDefaults(t),this.dragging=!0},this.handleDragLeave=t=>{this.stopDefaults(t),this.dragging=!1},this.handleDragOver=t=>{this.stopDefaults(t),this.dragging=!0},this.handleDrop=t=>{this.stopDefaults(t),this.dragging=!1,Array.from(t.dataTransfer.files).forEach(t=>{this.previewFile(t)})},this.stopDefaults=t=>{t.preventDefault(),t.stopPropagation()},this.uploadFile=(t,i)=>{(function(){const t=new x;return Object.freeze({options(i){return t.setConfig(i),this},send(i,e){return e.size>5e6?(t.start(i,e),this):(t.regularUpload(i,e),this)},onProgress(i){return t.on("onProgress",i),this},onError(i){return t.on("onError",i),this},onSuccess(i){return t.on("onSuccess",i),this}})})().options({}).send(this.applicationId,t).onProgress((t,e)=>{this.previewFiles=this.previewFiles.map(s=>s.id!==i.id?s:Object.assign(Object.assign({},s),{progress:100*t/e}))}).onSuccess(t=>{const e=t.data;e.dataUrl=i.src,this.taFileUpload.emit(e),this.previewFiles=this.previewFiles.filter(t=>t.id!==i.id)}).onError(()=>{this.previewFiles=this.previewFiles.map(t=>t.id!==i.id?t:Object.assign(Object.assign({},t),{failed:!0}))})},this.previewFile=t=>{const i=t.type.split("/")[0];let e={id:o(1e4),progress:0,name:r(t.name,48),failed:!1,isImage:!1,src:""};if("image"!==i)return this.uploadFile(t,e),void(this.previewFiles=[...this.previewFiles,e]);let s=new FileReader;s.readAsDataURL(t),s.onloadend=()=>{e=Object.assign(Object.assign({},e),{src:s.result,isImage:!0}),this.uploadFile(t,e),this.previewFiles=[...this.previewFiles,e]}},this.taFileUpload=s(this,"taFileUpload",7)}get uploadingFilesCount(){const t=this.previewFiles.filter(t=>!t.failed).length;return 1===t?"Uploading 1 item":`Uploading ${t} items`}render(){return i(e,{onDragEnter:this.handleDragEnter,onDragOver:this.handleDragOver,onDragLeave:this.handleDragLeave,onDrop:this.handleDrop,class:{dragging:this.dragging}},i("slot",null),this.previewFiles.length>0?i("div",{class:"gallery"},i("ta-card",null,i("div",{class:"gallery-heading"},"Uploading 1 item"),this.previewFiles.map(t=>i("ta-dragger-preview-file",{file:t})))):null)}};f.style=":host{display:block;width:var(--ta-dragger-width, 100%);height:var(--ta-dragger-height, 100%);border-radius:12px;position:relative}:host(.dragging){border:solid 2px var(--primary-color);background:rgba(254, 110, 113, .1)}.gallery{position:fixed;width:400px;bottom:20px;right:20px}.gallery-heading{height:50px;background:var(--primary-color);border-radius:12px 12px 0 0;position:relative;display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;color:white;font-size:14px;padding:0 20px}ta-card{--ta-card-padding:0}";const g=class{constructor(i){t(this,i),this.displayConfirmModal=!1,this.deletingFile=!1,this.onCopyClick=t=>{t.preventDefault(),t.stopPropagation(),a(this.file.url),h().success("File link copied to clipboard")},this.onDeleteClick=()=>{this.toggleConfirmModal()},this.onSuccess=()=>{h().success("File was deleted"),this.toggleConfirmModal(),this.taFileWasDeleted.emit(this.file)},this.onError=t=>{t.error?h().danger(t.error):h().danger("Error deleting file")},this.toggleConfirmModal=()=>{this.displayConfirmModal=!this.displayConfirmModal},this.deleteFile=()=>{this.deletingFile=!0,c().delete(this.file.id).then(this.onSuccess).catch(this.onError).finally(()=>this.deletingFile=!1)},this.taFileWasDeleted=s(this,"taFileWasDeleted",7)}get backgroundImg(){const{file:t}=this;return t.dataUrl?`url(${t.dataUrl})`:`url(${this.file.url}?width=450)`}get fileImg(){const{file:t}=this;return t.dataUrl?t.dataUrl:`${this.file.url}?width=240`}get shouldPreview(){return"image"===this.file.mimeType}get confirmDeleteModal(){return i("ta-modal",{titleText:`Delete ${this.file.fileName}`,bodyText:"Are you sure you want to delete this file?",confirmBtnText:"Delete",display:this.displayConfirmModal,onTaClose:this.toggleConfirmModal,onTaSubmit:this.deleteFile,loading:this.deletingFile})}render(){return i(e,null,i("div",{class:{"file-card-image":!0,"default-img":!this.shouldPreview},style:{backgroundImage:this.shouldPreview?this.backgroundImg:"url('../../../assets/file.svg')"}},i("div",{class:"overlay"}),i("div",{class:"controls"},i("div",{class:"control-icon"},i("ta-icon",{onTaClick:this.onCopyClick,icon:"copy"})),i("div",{class:"control-icon"},i("ta-icon",{onTaClick:this.onDeleteClick,icon:"trash"})))),i("div",{class:"image-details"},i("div",{class:"names"},i("ta-tooltip",{text:this.file.fileName},i("div",{class:"file-name"},r(this.file.fileName,12)))),i("div",{class:"other-details"},i("div",{class:"type"},this.file.extension.toUpperCase()),i("div",{class:"file-size"},`${n(this.file.size,1)}`))),this.confirmDeleteModal)}};g.style=":host{position:relative;display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;-ms-flex-pack:justify;justify-content:space-between;border-radius:6px;height:210px;-webkit-box-shadow:0 4px 12px 0 rgba(0, 0, 0, 0.14);box-shadow:0 4px 12px 0 rgba(0, 0, 0, 0.14)}.names{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-pack:justify;justify-content:space-between}.no-image{height:100%;position:relative;border-radius:6px 6px 0 0;display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center}.file-card-image{height:100%;border-radius:6px 6px 0 0;background-size:cover;background-position:center;position:relative;display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center;background-repeat:no-repeat}.file-card-image.default-img{background-size:initial;background-repeat:no-repeat}.image-details{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;background-color:white;border-top:solid 1px var(--light-border-color);border-bottom:solid 1px var(--light-border-color);border-radius:0 0 6px 6px;padding:0 4px;-ms-flex-pack:distribute;justify-content:space-around;min-height:50px}.details{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;background-color:white;border-top:solid 1px var(--light-border-color);border-bottom:solid 1px var(--light-border-color);height:auto;border-radius:0 0 6px 6px;padding:0 4px;-ms-flex-pack:distribute;justify-content:space-around;min-height:50px}.tags{display:-ms-flexbox;display:flex;-ms-flex-wrap:nowrap;flex-wrap:nowrap;-ms-flex-pack:start;justify-content:flex-start;width:100px;overflow-x:scroll;-ms-overflow-style:none}.tags::-webkit-scrollbar{display:none}.tag{padding:2px;font-size:12px;color:white;background-color:var(--primary-text-color);border-radius:3px;margin-left:2px;white-space:nowrap}.file-name{font-size:14px;color:var(--primary-text-color)}.other-details{height:15px;display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-pack:justify;justify-content:space-between;font-size:12px;color:var(--light-text-color)}.overlay{position:absolute;top:0;right:0;left:0;bottom:0;background-color:rgba(0, 0, 0, 0.4);opacity:0;border-radius:6px 6px 0 0}.control-icon{display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;text-align:center;-ms-flex-align:center;align-items:center;border-radius:50%;height:28px;width:28px}.control-icon:hover{background-color:white}.control-icon ta-icon{cursor:pointer}:host(:hover) .overlay{opacity:1;-webkit-transition:opacity 0.3s;transition:opacity 0.3s}.controls{position:absolute;bottom:4px;right:10px;opacity:0;display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-pack:justify;justify-content:space-between;-ms-flex-align:center;align-items:center}:host(:hover) .controls{opacity:1;-webkit-transition:opacity 0.4s;transition:opacity 0.4s}ta-icon{--ta-icon-fill:#fff;--ta-icon-width:14px;--ta-icon-height:14px}ta-icon:hover{--ta-icon-fill:var(--primary-color)}ta-modal{--ta-modal-height:120px}";export{d as application_details_sidebar,f as ta_dragger,g as ta_file_card}