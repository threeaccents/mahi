import{r as t,h as i,d as s,H as e}from"./p-cd2828d1.js";import"./p-4c11f27f.js";import{A as o}from"./p-c60f5320.js";import{t as n}from"./p-df5b8a0d.js";import{U as a}from"./p-1f4f58ae.js";const r={name:"",error:""},h=class{constructor(e){t(this,e),this.fetchingApplication=!1,this.application=null,this.fetchingUsers=!0,this.spaceUsersOptions=[],this.formErr=r,this.updatingApplication=!1,this.applicationId=this.history.location.query.applicationId,this.getApplicationState=()=>{const{state:t}=this.history.location;if(!t||!t.application)return this.fetchApplication();const{name:i,description:s,users:e}=t.application;this.application={name:i,description:s,userIds:e.map(t=>t.id)},this.initialApplication=this.application},this.fetchApplication=()=>{this.fetchingApplication=!0,o().get(this.applicationId).then(this.onFetchApplicationSuccess).catch(this.handleError).finally(()=>this.fetchingApplication=!1)},this.onFetchApplicationSuccess=t=>{const i=t.data,{name:s,description:e}=i;this.application={name:s,description:e},this.initialApplication=this.application},this.loadUsers=()=>{a().listSpaceUsers().then(this.onListSpaceUserSuccess).catch(this.handleError).finally(()=>this.fetchingUsers=!1)},this.onListSpaceUserSuccess=t=>{const i=t.data.map(t=>({text:`${t.firstName} ${t.lastName}`,value:t.id}));this.spaceUsersOptions=i},this.handleError=t=>{if(!t.error)return n().danger("Oops! Something went wrong. Please refresh and try again"),console.log(t);this.formErr=Object.assign(Object.assign({},this.formErr),{error:t.error})},this.validate=()=>{const{application:t}=this;let i={};return""===t.name&&(i=Object.assign(Object.assign({},i),{name:"Name is required"})),0===Object.keys(i).length?Promise.resolve():Promise.reject(i)},this.onSubmit=t=>{t.preventDefault(),this.validate().then(this.updateApplication).catch(this.handleValidationErrors)},this.handleValidationErrors=t=>{this.formErr=t},this.updateApplication=()=>{this.updatingApplication=!0;const t=this.application;o().update(this.applicationId,t).then(this.onUpdateApplicationSuccess).catch(this.handleError).finally(()=>this.updatingApplication=!1)},this.onUpdateApplicationSuccess=t=>{n().success("Application was updated!"),this.taApplicationWasUpdated.emit(t.data),this.handleClose()},this.handleClose=()=>{this.history.push(this.history.location.pathname)},this.updateApplicationField=(t,i)=>{this.formErr=r,this.application=Object.assign(Object.assign({},this.application),{[t]:i})},this.getUsersField=()=>{const{fetchingUsers:t,spaceUsersOptions:s,application:e}=this;if(0!==s.length)return i("ta-multi-select",{loading:t,label:"Add Users",value:e.userIds,options:s,onTaSelect:t=>this.updateApplicationField("userIds",t.detail)})},this.taApplicationWasUpdated=s(this,"taApplicationWasUpdated",7)}componentWillLoad(){this.loadUsers(),this.getApplicationState()}get hasNoFieldUpdates(){return JSON.stringify(this.initialApplication)===JSON.stringify(this.application)}render(){const{application:t,formErr:s}=this,{name:o,error:n}=s;return this.fetchingApplication?i("ta-loader",null):i(e,null,i("div",{class:"header"},i("div",{class:"close-icon",onClick:this.handleClose},i("ta-icon",{icon:"close"}))),i("ta-form",{onTaSubmit:t=>this.onSubmit(t)},i("label",null,"Edit Application"),i("ta-input",{value:t.name,label:"Application Name",onTaInput:t=>this.updateApplicationField("name",t.detail),error:o}),i("ta-textarea",{value:t.description,label:"Description",onTaInput:t=>this.updateApplicationField("description",t.detail)}),this.getUsersField(),i("ta-error",{error:n}),i("ta-button",{disabled:this.hasNoFieldUpdates,loading:this.updatingApplication,onTaClick:t=>this.onSubmit(t)},"Save"),i("ta-button",{color:"white",onTaClick:this.handleClose},"Cancel")))}};h.style=":host{display:block}.form-title{font-size:24px;font-weight:bold;font-stretch:normal;font-style:normal;line-height:normal;letter-spacing:-0.09px;color:var(--primary-text-color)}label{font-size:14px;font-weight:bold;font-stretch:normal;font-style:normal;line-height:normal;letter-spacing:-0.05px;color:var(--dark-text-color);margin-bottom:24px;display:block}.header{display:-ms-flexbox;display:flex;-ms-flex-pack:end;justify-content:flex-end}.close-icon{font-size:24px;font-weight:normal;font-stretch:normal;font-style:normal;line-height:normal;letter-spacing:-0.09px;text-align:center;color:var(--light-text-color);cursor:pointer}ta-icon{--ta-icon-fill:#c3cbd3}";export{h as edit_application_view}