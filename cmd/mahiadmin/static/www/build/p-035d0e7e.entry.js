import{r as e,h as t,H as r}from"./p-cd2828d1.js";import"./p-4c11f27f.js";import{A as s}from"./p-c60f5320.js";import{t as o}from"./p-df5b8a0d.js";const i={name:"",description:"",deliveryUrl:"",storageEngine:"s3",storageSecretKey:"",storageEndpoint:"",storageRegion:"",storageAccessKey:""},a=["sfo1","sfo2","sfo3","nyc1","nyc2","nyc3","ams1","ams2","ams3","sgp1","lon1","fra1","tor1","blr1"],n=["us-east-2","us-east-1","us-west-1","us-west-2","ap-east-1","ap-south-1","ap-northeast-3","ap-northeast-2","ap-southeast-1","ap-southeast-2","ap-northeast-1","ca-central-1","cn-north-1","cn-northwest-1","eu-central-1","eu-west-1","eu-west-2","eu-west-3","eu-north-1","sa-east-1","me-south-1"],l=["us-east-1","us-west-1","eu-central-1"],c={nameErr:"",storageSecretKeyErr:"",storageAccessKeyErr:"",storageRegionErr:"",deliveryUrlErr:"",error:""},h=class{constructor(r){e(this,r),this.newApplication=i,this.formErr=c,this.creatingApplication=!1,this.spaceUsersOptions=[],this.onSubmit=e=>{e.preventDefault(),this.validate().then(this.createApplication).catch(this.handleValidationErrors)},this.handleValidationErrors=e=>{this.formErr=e},this.createApplication=()=>{this.creatingApplication=!0;const e=this.newApplication;s().create(e).then(this.onCreateApplicationSuccess).catch(this.handleError).finally(()=>this.creatingApplication=!1)},this.onCreateApplicationSuccess=e=>{o().success("Application was created!"),this.resetForm(),this.history.push(`/applications/${e.data.id}`)},this.handleError=e=>{if(!e.error)return this.formErr.error="Oops! Something went wrong. Please refresh and try again",console.log(e);const t=e.error;if(!t.includes("application name is taken"))return t.includes("connection")?(this.formErr.error="Error with connection. Please double check your credentials are correct",console.log(e)):void o().danger(t);this.formErr=Object.assign(Object.assign({},this.formErr),{nameErr:"Application name is taken"})},this.validate=()=>{const{newApplication:e}=this;let t={};return""===e.name&&(t=Object.assign(Object.assign({},t),{nameErr:"Name is required"})),""===e.deliveryUrl&&(t=Object.assign(Object.assign({},t),{deliveryUrlErr:"CDN url is required"})),""===e.storageAccessKey&&(t=Object.assign(Object.assign({},t),{storageAccessKeyErr:"Access key is required"})),""===e.storageSecretKey&&(t=Object.assign(Object.assign({},t),{storageSecretKeyErr:"Secret key is required"})),"b2"!==e.storageEngine&&""===e.storageRegion&&(t=Object.assign(Object.assign({},t),{storageRegionErr:"Bucket region is required"})),0===Object.keys(t).length?Promise.resolve():Promise.reject(t)},this.updateNewApplication=(e,t)=>{this.formErr=c,this.newApplication=Object.assign(Object.assign({},this.newApplication),{[e]:t})},this.handleClose=()=>{const e=this.history.location.pathname;this.resetForm(),this.history.push(e)},this.resetForm=()=>{this.newApplication=i,this.formErr=c},this.getCustomFormFields=()=>{const{newApplication:e,formErr:r}=this,{storageRegionErr:s,storageSecretKeyErr:o,storageAccessKeyErr:i}=r;return t("span",null,t("custom-storage-engine-input",{value:e.storageEngine,onTaSelect:e=>this.updateNewApplication("storageEngine",e.detail)}),t("span",null,t("ta-input",{value:e.storageAccessKey,label:"API Access Key",onTaInput:e=>this.updateNewApplication("storageAccessKey",e.detail),error:i}),t("ta-input",{type:"password",value:e.storageSecretKey,label:"API Secret Key",onTaInput:e=>this.updateNewApplication("storageSecretKey",e.detail),error:o}),"b2"!==e.storageEngine?t("ta-select",{value:e.storageRegion,onTaSelect:e=>this.updateNewApplication("storageRegion",e.detail),placeholder:"Select Bucket Region",error:s},this.getStorageRegions().map(e=>t("ta-select-option",{value:e,label:e.toUpperCase()}))):null))}}getStorageRegions(){switch(this.newApplication.storageEngine){case"digital_ocean":return a;case"s3":return n;case"wasabi":return l;default:return[]}}render(){const{newApplication:e,formErr:s}=this,{nameErr:o,error:i,deliveryUrlErr:a}=s;return t(r,null,t("div",{class:"header"},t("div",{class:"close-icon",onClick:this.handleClose},t("ta-icon",{icon:"close"}))),t("ta-form",{onTaSubmit:e=>this.onSubmit(e)},t("label",null,"Create Application"),t("ta-input",{value:e.name,label:"Application Name",onTaInput:e=>this.updateNewApplication("name",e.detail),error:o}),t("ta-input",{value:e.deliveryUrl,label:"CDN Url",onTaInput:e=>this.updateNewApplication("deliveryUrl",e.detail),error:a}),t("ta-textarea",{value:e.description,label:"Description",onTaInput:e=>this.updateNewApplication("description",e.detail)}),t("label",null,"Storage Details"),this.getCustomFormFields(),t("ta-error",{error:i}),t("ta-button",{loading:this.creatingApplication,onTaClick:e=>this.onSubmit(e)},"Create Application"),t("ta-button",{color:"white",onTaClick:this.handleClose},"Cancel")))}};h.style=":host{display:block}.form-title{font-size:24px;font-weight:bold;font-stretch:normal;font-style:normal;line-height:normal;letter-spacing:-0.09px;color:var(--primary-text-color)}label{font-size:14px;font-weight:bold;font-stretch:normal;font-style:normal;line-height:normal;letter-spacing:-0.05px;color:var(--dark-text-color);margin-bottom:24px;display:block}.header{display:-ms-flexbox;display:flex;-ms-flex-pack:end;justify-content:flex-end}.close-icon{font-size:24px;font-weight:normal;font-stretch:normal;font-style:normal;line-height:normal;letter-spacing:-0.09px;text-align:center;color:var(--light-text-color);cursor:pointer}ta-icon{--ta-icon-fill:#c3cbd3}";export{h as create_application_view}